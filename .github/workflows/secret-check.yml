name: Secret Check
on: [workflow_dispatch]

jobs:
  check:
    runs-on: ubuntu-latest
    env:
      GCP_SA_KEY: ${{ secrets.GCP_SERVICE_ACCOUNT_KEY }}
    steps:
      - name: Verificar que exista el secreto
        run: |
          if [ -z "$GCP_SA_KEY" ]; then
            echo "Secret missing" && exit 1
          fi
          echo "Secret present ✅"

      - name: Escribir a archivo y validar JSON
        run: |
          printf '%s' "$GCP_SA_KEY" > key.json
          python3 - <<'PY'
import json
with open('key.json','r',encoding='utf-8') as f:
    json.load(f)
print('Valid JSON ✅')
PY
