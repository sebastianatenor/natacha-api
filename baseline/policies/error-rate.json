{
  "displayName": "Cloud Run Â· Error rate > 2% (5m)",
  "documentation": { "content": "Error rate sobre el 2% en 5 minutos para el servicio.", "mimeType": "text/markdown" },
  "userLabels": { "env": "prod", "service": "natacha-api" },
  "conditions": [
    {
      "displayName": "5xx ratio > 0.02",
      "conditionMonitoringQueryLanguage": {
        "duration": "300s",
        "query": "fetch cloud_run_revision\n| filter resource.service_name == \"natacha-api\" && resource.location == \"us-central1\"\n| { good: metric 'run.googleapis.com/request_count' | filter metric.response_code_class != \"5xx\";\n    bad:  metric 'run.googleapis.com/request_count' | filter metric.response_code_class == \"5xx\" }\n| align rate(1m)\n| group_by [resource.service_name], [good: sum(good.value), bad: sum(bad.value)]\n| condition bad / (good + bad) > 0.02"
      }
    }
  ],
  "notificationChannels": [],
  "enabled": true,
  "combiner": "OR"
}
